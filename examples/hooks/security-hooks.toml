# Security Hooks for Kimi Code CLI
# 安全相关的 Hooks 配置示例

# ============================================
# 1. AI 安全检测 - 危险命令检查
# ============================================
[[hooks.before_tool]]
name = "ai-dangerous-command-check"
type = "prompt"
matcher = { tool = "Shell" }
prompt = """
你是一个安全分析助手。请分析以下 Shell 命令是否存在风险。

命令: {{tool_input.command}}
工作目录: {{work_dir}}

请判断该命令是否：
1. 可能删除重要文件或目录（如 rm -rf /, rm -rf ~, rm -rf .git）
2. 可能清空数据库或表
3. 可能修改系统关键配置
4. 可能泄露敏感信息
5. 可能执行未经验证的远程脚本

返回严格的 JSON 格式：
{
    "decision": "allow" | "deny" | "ask",
    "reason": "决策原因的简要说明"
}

规则：
- "deny": 明确危险的操作，如 rm -rf /、格式化磁盘等
- "ask": 有风险但需要用户确认的操作，如删除.git、修改配置文件等
- "allow": 安全的常规操作
"""
temperature = 0.1

# ============================================
# 2. 敏感信息泄露检测
# ============================================
[[hooks.before_tool]]
name = "secret-leak-detection"
type = "prompt"
matcher = { tool = "WriteFile" }
prompt = """
检查即将写入的文件是否包含敏感信息。

文件路径: {{tool_input.path}}
内容预览（前1000字符）: {{tool_input.content[:1000]}}

查找以下敏感信息模式：
- API 密钥（api_key, apikey, api-key）
- 密码/密钥（password, secret, token）
- 私钥（private_key, rsa_key, ssh_key）
- 数据库连接字符串（含密码）
- 访问令牌（access_token, bearer）

返回严格的 JSON 格式：
{
    "decision": "allow" | "deny",
    "reason": "如果检测到敏感信息，说明具体类型和位置"
}
"""
temperature = 0.1

# ============================================
# 3. 网络请求安全检查
# ============================================
[[hooks.before_tool]]
name = "network-request-check"
type = "prompt"
matcher = { tool = "Shell", pattern = "curl|wget|http" }
prompt = """
分析以下网络请求命令的安全性：

命令: {{tool_input.command}}

检查：
1. 是否访问了不安全的 HTTP 地址（非 HTTPS）
2. 是否下载并执行远程脚本（curl ... | bash）
3. 是否包含敏感信息在 URL 中

返回严格的 JSON 格式：
{
    "decision": "allow" | "deny" | "ask",
    "reason": "检查结果的说明"
}
"""
temperature = 0.1
